---
title: 3.5. Namespace의 한계점
category: 하나씩 익히는 Container
date: 2020-11-30T12:00:00Z
lastmod: 2020-11-30T12:00:00Z
comment: true
adsense: true
---

### Namespace의 한계점

지금까지 PID, Network, Mount Namespace에 대해서 알아보았다. 이러한 Namespace들을 통해서 각 Container는 높은 수준의 격리된 환경에서 동작 가능하다. 하지만 현재까지 Namespace는 완전한 격리 환경을 제공하지는 못한다. 예를들어 Kernel의 Network Stack 관련 몇몇 설정들은 모든 Network Namespace에서 공유되어 이용된다.

conntrack은 Linux에서 Network Connection을 관리하는 Module이다. conntrack이 관리할 수 있는 최대 Connection 개수는 "/proc/sys/net/netfilter/nf_conntrack_max" 파일에서 확인할 수 있으며, "/proc/sys/net/netfilter/nf_conntrack_max" 파일에 숫자를 써서 conntrack이 관리할 수 있는 최대 Connection 개수도 변경할 수 있다. conntrack의 최대 Connection의 개수는 모든 Network Namespace가 공유한다.

{% highlight console %}
# netshoot Container 생성
(host)# docker run -d --rm --name netshoot nicolaka/netshoot sleep infinity

# Host에서 conntrack의 최대 Connection의 개수확인
(host)# cat /proc/sys/net/netfilter/nf_conntrack_max
131072

# netshoot Container에서 conntrack의 최대 Connection의 개수확인
(netshoot)# docker exec -it netshoot cat /proc/sys/net/netfilter/nf_conntrack_max
131072

# Host에서 conntrack의 최대 Connection의 개수 변경 및 확인
(host)# echo 200000 > /proc/sys/net/netfilter/nf_conntrack_max
(host)# cat /proc/sys/net/netfilter/nf_conntrack_max
200000

# netshoot Container에서 변경된 conntrack의 최대 Connection의 개수확인
(netshoot)# docker exec -it netshoot cat /proc/sys/net/netfilter/nf_conntrack_max
200000
{% endhighlight %}
<figure>
<figcaption class="caption">[Shell 1] conntrack의 최대 Connection 개수 변경</figcaption>
</figure>

[Shell 1]은 Host에서 conntrack의 최대 Connection 개수를 확인 및 변경한 다음, netshoot Container에서도 conntrack의 최대 Connection 개수를 확인하는 과정을 나타내고 있다. conntrack의 최대 Connection 개수는 모든 Network Namespace에서 공유되기 때문에, Host에서 변경한 conntrack의 최대 Connection 개수가 netshoot Container에서도 동일하게 보이게 된다. 이처럼 Network Namespace는 conntrack의 최대 Connection 개수까지는 Isolation하지는 않는다.

